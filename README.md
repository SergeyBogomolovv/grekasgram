# Grekasgram - Онлайн-мессенджер на next.js + nest.js

## Как запустить

- Клонируем репозиторий
- Создаем .env файл с необходимыми параметрами
- Параметры для .env

```env
POSTGRES_DB=Имя базы данных
POSTGRES_USER=Пользователь базы данных
POSTGRES_PASSWORD=Пароль базы данных
POSTGRES_PORT=Порт базы данных
POSTGRES_HOST=Хост базы данных

REDIS_HOST=Хост редиса
REDIS_PORT=Порт редиса
REDIS_TTL=Время жизни кэша

JWT_SECRET=секретный jwt токен

MAIL_HOST=Хост почтового провайдера
MAIL_PORT=Порт почтового провайдера
MAIL_USER=Пользователь почтового провайдера
MAIL_PASS=Пароль от почтового провайдера

CORS_ORIGIN=Домен сайта
CONFIRM_EMAIL_URL=Url, на который будет произведен редирект с токеном из письма

OBJECT_STORAGE_ACCESS=access токен обьектного хранилища
OBJECT_STORAGE_SECRET=секретный токен обьектного хранилища
OBJECT_STORAGE_ENDPOINT=ендпоинт обьектного хранилища
OBJECT_STORAGE_REGION=регион обьектного хранилища
OBJECT_STORAGE_BUCKET=бакет обьектного хранилища
NODE_ENV=production

PORT=порт бэкенда

NEXT_PUBLIC_API_URL=url бэкенда
API_URL=url бэкенда(для ssr)
NEXT_PUBLIC_WS_URL=url ws бэкенда
```

- Запускаем через docker-compose ```docker compose up -d```
  
## Описание архитектуры проекта (Frontend)

### Entities

- Chat - ui карточки чата и группы, которая отображается в чатбаре, так же тут будет все crud операции с чатами в будущем
- Message - ui сообщения и crud операции (удаление, редактирование)
- User - ui карточки пользователя и crud операции с пользователями
- Session - ui списка сессий и crud операции

### Features

- Auth - формы авторизации и работа с api
- Chats - сам чат, где сообщения и т.д., возможно стоит вынести в widgets в дальнейшем
- Chatbar - поиск чатов, пользователей и групп, отображает соответсвующие карточки и общий инпут поиска
- Navigation - все компоненты навигации (мобильный футер, сайдбар, мобильный дравер с чатами, навбар)
- Profile - форма для обновления данных о профиле

### TODO

- Внести куда то профиль других пользователей

## Auth Flow

В данном приложении используется авторизация через jwt токен, который ставится в httpOnly cookie и проверяется с каждый запросом

- При авторизации, отправляется запрос, валидируются данные и создается сессия, которая содержит в себе id пользователя, user-agent и ip адрес, откуда был произведен вход. Эта сессия хранится в базе данных и так же кэшируется. На клиент ставится токен, в который зашит id сессии
- При аунтефикации сначала проверяется jwt токен на валидность, потом проверяется что сессия существует и не истекла и далее, если все ок, информация из сессии ставится в запрос для дальнейшей работы

## Используемые технологии

### Frontend

- Фреймворк: Next.js
- Стилизация: Tailwindcss + shadcn/ui
- Для работы с формами и валидации используются react-hook-form и zod
- В качестве стейт-менеджера: react-query
- Для работы с real-time: socket-io
- Тестирование: vitest

### Backend

- Фреймворк: Nest.js
- ORM и БД:  TypeORM + Postgresql
- Кэширование: Redis
- Работа с s3 хранилищем: aws-sdk-client
- Отправка писем: nodemailer

### Devops

- Proxy: Nginx
- Контейнеризация: Docker
